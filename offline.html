<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无法连接至服务器 - 小舟工具箱</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            background-image:
                radial-gradient(#111 1px, transparent 1px),
                radial-gradient(#111 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: bold;
            text-shadow: none;
            filter: none;
        }

        .game-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 400px;
            margin: 20px auto;
            border: 4px solid #4CAF50;
            background-color: #111;
            box-shadow:
                0 0 20px rgba(76, 175, 80, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 0.8);
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            image-rendering: -webkit-optimize-contrast;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            margin: 0 auto;
        }

        @media (max-width: 480px) {
            .game-container {
                max-width: 300px;
                height: 300px;
            }
        }

        @media (max-width: 350px) {
            .game-container {
                max-width: 250px;
                height: 250px;
            }
        }

        .start-prompt {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border: 2px solid #4CAF50;
            color: #4CAF50;
            font-size: 18px;
            cursor: pointer;
            box-shadow:
                inset 2px 2px 0 0px #4CAF50,
                inset -2px -2px 0 0px #000;
            line-height: 1.5;
        }

        /* 开始提示按钮按下效果 */
        .start-prompt:active,
        .start-prompt.pressed {
            box-shadow:
                inset 2px 2px 0 0px #000,
                inset -2px -2px 0 0px #4CAF50;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            max-width: 200px;
            margin: 20px auto;
            padding: 20px;
        }

        .control-btn {
            background-color: #333;
            color: #4CAF50;
            border: 2px solid #4CAF50;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            text-align: center;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            border-radius: 0;
            box-shadow:
                inset 2px 2px 0 0px #4CAF50,
                inset -2px -2px 0 0px #000; 
        }

        /* 按钮按下效果：内阴影颜色互换 */
        .control-btn:active,
        .control-btn.pressed {
            box-shadow:
                inset 2px 2px 0 0px #000,
                inset -2px -2px 0 0px #4CAF50;
        }

        .up-btn {
            grid-column: 2;
            grid-row: 1;
        }

        .left-btn {
            grid-column: 1;
            grid-row: 2;
        }

        .down-btn {
            grid-column: 2;
            grid-row: 2;
        }

        .right-btn {
            grid-column: 3;
            grid-row: 2;
        }

        .info-section {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #111;
            border: 2px solid #4CAF50;
            line-height: 1.6;
        }

        .info-section h1 {
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 1.8em;
        }

        .info-section p {
            margin: 15px 0;
        }

        .info-section ul {
            list-style: none;
            padding-left: 0;
        }

        .info-section ul li {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
            list-style: none;
        }

        .info-section ul li:before {
            content: "■ ";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
            font-size: 0.5em;
        }

        .info-section strong {
            color: #FFC107;
        }

        .info-section em {
            color: #90A4AE;
        }
        
        .pixel-art {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            image-rendering: -webkit-optimize-contrast;
        }

        .bit-text {
            letter-spacing: 2px;
            text-shadow: 2px 2px 0 #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-container">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            <div class="start-prompt" id="startPrompt">点击开始游戏</div>
        </div>

        <div class="controls">
            <div class="control-btn up-btn" id="upBtn">↑</div>
            <div class="control-btn left-btn" id="leftBtn">←</div>
            <div class="control-btn right-btn" id="rightBtn">→</div>
            <div class="control-btn down-btn" id="downBtn">↓</div>
        </div>

        <div class="info-section">
            <h1 class="bit-text">无法连接至服务器</h1>
            <ul>
                <li>请检查设备网络是否正常</li>
                <li>服务器在国外，短时间暂时无法访问是正常的，稍后再试</li>
                <li>尝试更换DNS服务器</li>
                <li>您可以<a href="/">返回首页</a>，使用已缓存的内容</li>
            </ul>
        </div>
    </div>

    <footer style="
        text-align: center;
        padding: 20px;
        margin-top: 20px;
        color: #4CAF50;
        font-family: 'Courier New', monospace;
        border-top: 1px solid #4CAF50;
    ">
        <p>© 2026 小舟工具箱</p>
        <p>音效 by <a href="https://www.littlerobotsoundfactory.com" target="_blank" rel="noopener">Little Robot Sound Factory</a></p>
    </footer>

    <script>
        // 彩蛋相关变量
        const konamiCode = [
            'ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown',
            'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight',
            'KeyB', 'KeyA', 'Enter'
        ];
        let konamiIndex = 0;

        // 音效
        let eatSound = new Audio("/icon/8-bit/eat.mp3");
        let deathSound = new Audio("/icon/8-bit/death.mp3");
        let moveSound = new Audio("/icon/8-bit/move.mp3");
        let konamiSound = new Audio("/icon/8-bit/konami.mp3");

        function playEatSound() {
            if(eatSound) eatSound.play();
        }

        function playDeathSound() {
            if(deathSound) deathSound.play();
        }

        function playMoveSound() {
            if(moveSound) moveSound.play();
        }

        function playKonamiSound() {
            if(konamiSound) konamiSound.play();
        }

        // 游戏变量
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startPrompt = document.getElementById('startPrompt');

        function getGridSize() {
            const desiredTileCount = 20;
            return Math.floor(canvas.width / desiredTileCount);
        }

        let gridSize = getGridSize();
        const tileCount = 20;
        
        let snake = [];
        let food = {};
        let dx = 0;
        let dy = 0;
        let score = 0;
        let gameRunning = false;
        let gameLoop;

        // 初始化游戏
        function initGame() {
            // 初始位置
            snake = [
                {x: 10, y: 10},
                {x: 9, y: 10},
                {x: 8, y: 10}
            ];
            
            // 初始方向向右
            dx = 1;
            dy = 0;
            
            // 生成食物
            generateFood();
            
            startPrompt.style.display = 'none';
            
            // 开始游戏循环
            if (gameLoop) clearInterval(gameLoop);
            gameRunning = true;
            gameLoop = setInterval(main, 250); // 速度ms
        }

        // 生成食物
        function generateFood() {
            food = {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
            
            // 确保食物不在蛇身上
            for (let segment of snake) {
                if (segment.x === food.x && segment.y === food.y) {
                    generateFood();
                    break;
                }
            }
        }

        // 绘制游戏
        function drawGame() {
            // 更新网格大小以适应响应式设计
            gridSize = getGridSize();

            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = '#222';
            for (let i = 0; i < tileCount; i++) {
                for (let j = 0; j < tileCount; j++) {
                    ctx.strokeRect(i * gridSize, j * gridSize, gridSize, gridSize);
                }
            }

            // 绘制蛇
            ctx.fillStyle = '#4CAF50';
            for (let i = 0; i < snake.length; i++) {
                ctx.fillRect(snake[i].x * gridSize, snake[i].y * gridSize, gridSize, gridSize);

                if (i === 0) {
                    ctx.fillStyle = '#8BC34A';
                    ctx.fillRect(snake[i].x * gridSize, snake[i].y * gridSize, gridSize, gridSize);
                    ctx.fillStyle = '#4CAF50';
                }
            }

            // 绘制食物
            ctx.fillStyle = '#FF5722';
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);
        }

        // 移动蛇
        function moveSnake() {
            if (!gameRunning) return;

            const head = {x: snake[0].x + dx, y: snake[0].y + dy};

            // 检查碰撞边界
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                if (konamiModeActive) {
                    // 无敌模式：碰到边界时停在边界
                    if (head.x < 0) head.x = 0;
                    if (head.x >= tileCount) head.x = tileCount - 1;
                    if (head.y < 0) head.y = 0;
                    if (head.y >= tileCount) head.y = tileCount - 1;
                } else {
                    playDeathSound();
                    gameOver();
                    return;
                }
            }

            // 检查碰撞自己
            let collisionWithSelf = false;
            for (let i = 0; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) {
                    collisionWithSelf = true;
                    break;
                }
            }

            if (collisionWithSelf) {
                if (konamiModeActive) {
                    // 无敌模式：碰到自己时直接穿过
                } else {
                    playDeathSound();
                    gameOver();
                    return;
                }
            }

            // 添加新头部
            snake.unshift(head);

            // 检查是否吃到食物
            if (head.x === food.x && head.y === food.y) {
                playEatSound();
                generateFood();
                score++;
            } else {
                // 移除尾部
                snake.pop();
            }
        }

        // 游戏结束
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);
            startPrompt.innerHTML = `游戏结束！<br>得分: ${score}<br>点击重新开始`;
            startPrompt.style.display = 'block';
        }

        // 主游戏循环
        function main() {
            moveSnake();
            drawGame();
        }

        // 彩蛋模式标志
        let konamiModeActive = false;

        // 激活Konami模式函数
        function activateKonamiMode() {
            konamiModeActive = true;
            playKonamiSound();
            // 修改边框为红色
            const gameContainer = document.querySelector('.game-container');
            gameContainer.style.borderColor = '#f44336';
            // 添加闪烁效果
            gameContainer.style.boxShadow = '0 0 20px rgba(244, 67, 54, 0.6)';
        }

        // 检测Konami码函数
        function checkKonamiCode(key) {
            if (key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    activateKonamiMode();
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;

                if (key === konamiCode[0]) {
                    konamiIndex = 1;
                }
            }
        }

        // 键盘事件监听
        document.addEventListener('keydown', (event) => {
            checkKonamiCode(event.code);
            changeDirection(event);
        });

        // 方向改变
        function changeDirection(event) {
            if (!gameRunning) return;

            const keyPressed = event.key;

            // 防止反向移动
            switch(keyPressed) {
                case 'ArrowUp':
                    if (dy === 0) {
                        dx = 0;
                        dy = -1;
                        playMoveSound();
                    }
                    break;
                case 'ArrowDown':
                    if (dy === 0) {
                        dx = 0;
                        dy = 1;
                        playMoveSound();
                    }
                    break;
                case 'ArrowLeft':
                    if (dx === 0) {
                        dx = -1;
                        dy = 0;
                        playMoveSound();
                    }
                    break;
                case 'ArrowRight':
                    if (dx === 0) {
                        dx = 1;
                        dy = 0;
                        playMoveSound();
                    }
                    break;
            }
        }

        // 触控按钮事件
        function addButtonPressEffect(button) {
            button.classList.add('pressed');
            setTimeout(() => {
                button.classList.remove('pressed');
            }, 150);
        }

        document.getElementById('upBtn').addEventListener('click', () => {
            if (dy === 0 && gameRunning) {
                dx = 0;
                dy = -1;
                playMoveSound();
            }
            addButtonPressEffect(document.getElementById('upBtn'));
        });

        document.getElementById('downBtn').addEventListener('click', () => {
            if (dy === 0 && gameRunning) {
                dx = 0;
                dy = 1;
                playMoveSound();
            }
            addButtonPressEffect(document.getElementById('downBtn'));
        });

        document.getElementById('leftBtn').addEventListener('click', () => {
            if (dx === 0 && gameRunning) {
                dx = -1;
                dy = 0;
                playMoveSound();
            }
            addButtonPressEffect(document.getElementById('leftBtn'));
        });

        document.getElementById('rightBtn').addEventListener('click', () => {
            if (dx === 0 && gameRunning) {
                dx = 1;
                dy = 0;
                playMoveSound();
            }
            addButtonPressEffect(document.getElementById('rightBtn'));
        });

        // 开始游戏事件
        canvas.addEventListener('click', () => {
            if (!gameRunning) {
                score = 0;
                initGame();
                playMoveSound();
            }
            addButtonPressEffect(startPrompt);
        });

        startPrompt.addEventListener('click', () => {
            if (!gameRunning) {
                score = 0;
                initGame();
            }
            addButtonPressEffect(startPrompt);
        });

        // 初始化绘制
        drawGame();
    </script>
</body>
</html>