<!DOCTYPE html>
<html lang="zh-CN" class="no-js">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="description" content="Minecraft指令工具箱，你需要的这里都有">
    <meta name="keywords" content="我的世界,Minecraft,MC,指令,命令,导航,网址,工具,网站,资源,基岩版,网易版,手机版">
    <title>小舟工具箱 - Minecraft指令工具箱</title>
    <!-- 预加载关键资源 -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    <link rel="preload" href="https://cn.windfonts.com/wenfeng/fonts/misa/regular/web/index.css" as="style" crossorigin='anonymous' onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cn.windfonts.com/wenfeng/fonts/misa/regular/web/index.css" crossorigin='anonymous'></noscript>
    <!-- 此中文网页字体由文风字体（Windfonts）免费提供，您可以自由引用，请务必保留此授权许可标注 https://wenfeng.org/license -->

    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/manifest.json">
    <script defer src="/alert-checker.js"></script>
    <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script>LA.init({id:"3Ltl0yXYWQcgbDgB",ck:"3Ltl0yXYWQcgbDgB"})</script>
    <link rel="preconnect" href="https://cn.windfonts.com" />

    <!-- 关键CSS：加载动画、no-js警告、基础重置和主题 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Misa', 'Microsoft YaHei', 'PingFang SC', 'HarmonyOS Sans SC', sans-serif;
        }

        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --text-color: #333;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --header-bg: #2c3e50;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        .no-js-warning {
            display: none;
        }

        .no-js .no-js-warning {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #CC3333;
            color: white;
            padding: 10px;
            text-align: center;
            margin: 0;
            z-index: 10000;
            opacity: 0;
            animation: fadeInNoJS 0.2s ease-in forwards;
            animation-delay: 5s;
        }

        @keyframes fadeInNoJS {
            to {
                opacity: 1;
            }
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.4514s ease;
        }

        #loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* 加载动画 来自 css-loaders.com */
        .loader {
            width: 40px;
            height: 40px;
            position: relative;
            --c: no-repeat linear-gradient(#1487f3 0 0);
            background:
                var(--c) center/100% 10px,
                var(--c) center/10px 100%;
        }

        .loader:before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                var(--c) 0 0,
                var(--c) 100% 0,
                var(--c) 0 100%,
                var(--c) 100% 100%;
            background-size: 15.5px 15.5px;
            animation: l16 1.5s infinite cubic-bezier(0.3, 1, 0, 1);
        }

        @keyframes l16 {
            33% {
                inset: -10px;
                transform: rotate(0deg)
            }

            66% {
                inset: -10px;
                transform: rotate(90deg)
            }

            100% {
                inset: 0;
                transform: rotate(90deg)
            }
        }

        .loading-text {
            color: white;
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>

    <!-- 加载外部主样式表 -->
    <link rel="stylesheet" href="style.css">
    <script src="modal.js"></script>
    <script>

        /* const IOSmodal_survey = {
            title: "问卷",
            id: "survey_1114",
            version: "202511210000",
            forceShow: false,
            content: `
                    <p>诚邀您用2分钟填写未来更新计划问卷，您的意见将帮助我们改进网站</p>
                    <p style="margin:0;font-size:13px;color:#666;line-height:1.4">问卷入口长期保留，导航栏「≡」菜单中可随时填写</p>
                    `,
            buttons: [
                { text: "填写问卷", style: "", action: "open_link", url: "https://f.kdocs.cn/g/JfmI2Ch8/" },
                { text: "关闭", style: "red", action: "close" },
            ]
        }; */

        /* document.addEventListener('DOMContentLoaded', function () {
            // showModal(IOSmodal_survey);
        }); */

        const IOSmodal_ai_link = {
            title: "AI助手",
            id: "ai_commander",
            version: "202511240000",
            forceShow: true,
            content: `
                    <p>注意：当前版本为 beta 测试版，还有很多不完善的地方<br>如有问题请带图反馈</p>
                    <p style="margin:0;font-size:13px;color:#666;line-height:1.4">目前知识库只有常用指令，等待进一步完善<br>ps：整理太费事了qwq到时候我恐怕都能倒背wiki了</p>
                    <p>请选择打开方式：</p>
                    `,
            buttons: [
                { text: "豆包", style: "blue", action: "open_link", url: "https://doubao.com/bot/gwZ4RSpF" },
                { text: "扣子", style: "blue", action: "open_link", url: "https://www.coze.cn/s/oo65B0_BEhY/" },
                { text: "返回", style: "gray", action: "close" },
            ]
        };

        function showSurveyModal() {
            showModal(IOSmodal_ai_link);
        }

        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
    </script>
</head>
<body>
    <!-- 加载动画 -->
    <div id="loading-overlay">
        <div class="loader"></div>
        <div class="loading-text">loading…</div>
    </div>

    <div id="js-warning" class="no-js-warning">
      请开启"允许运行JavaScript"后刷新网页，以体验完整功能！
    </div>

    <header>
        <div class="container">
            <div class="header-top">
                <div class="header-controls">
                <button class="menu-toggle" id="menuToggle">
                    <!-- 三横 -->
                    <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 7H19" />
                        <path d="M5 12H19" />
                        <path d="M5 17H19" />
                    </svg>
                </button>
                    <button class="theme-toggle" id="themeToggle">
                        <!-- 太阳 -->
                        <svg class="sun-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="1.5" fill="currentColor" />
                            <path d="M12 5V3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            <path d="M12 21V19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            <path d="M16.9497 7.05078L18.364 5.63647" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            <path d="M5.63599 18.3633L7.0502 16.9491" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            <path d="M19 12L21 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            <path d="M3 12L5 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            <path d="M16.9497 16.9492L18.364 18.3635" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            <path d="M5.63599 5.63672L7.0502 7.05094" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                        </svg>
                        <!-- 月亮 -->
                        <svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.735 15.887C19.8592 16.0994 18.9549 16.1616 18.0581 16.0708C17.1614 15.98 16.2857 15.7377 15.468 15.3546C14.6502 14.9716 13.9026 14.454 13.2572 13.8259C12.6117 13.1979 12.0782 12.4691 11.6801 11.6708C11.282 10.8725 11.0257 10.0168 10.9221 9.13901C10.8185 8.26124 10.8692 7.37503 11.0719 6.5175C9.36045 7.10055 7.923 8.19191 6.96853 9.62578C6.01405 11.0596 5.59644 12.7558 5.78511 14.4447C5.97379 16.1335 6.75624 17.7147 8.0049 18.9291C9.25356 20.1435 10.8929 20.9179 12.6646 21.1244C14.4363 21.331 16.2347 20.9567 17.7672 20.0646C19.2997 19.1725 20.4732 17.8159 21.085 16.215C21.2013 16.1132 21.2921 15.9864 21.3503 15.8444C21.4085 15.7024 21.4326 15.549 21.4206 15.3968C21.4087 15.2445 21.3612 15.0975 21.2822 14.9674C21.2031 14.8372 21.0949 14.7275 20.9667 14.647C20.8385 14.5665 20.694 14.5174 20.545 14.5037C20.3961 14.49 20.2472 14.5121 20.1097 14.5681C19.9722 14.6241 19.8501 14.7124 19.7533 14.8253C19.6565 14.9381 19.5878 15.0724 19.5531 15.217C19.5184 15.3615 19.5188 15.5123 19.5541 15.6565C19.5894 15.8007 19.6585 15.9344 19.7555 16.0464"
                                stroke="currentColor"
                                stroke-width="1.5"
                                stroke-linecap="round"
                                fill="none" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="header-content">
                <h1 class="title">小舟工具箱</h1>
                <p class="subtitle">MC指令工具箱，让复杂变简单</p>
            </div>
        </div>
    </header>
    <div class="menu-overlay" id="menuOverlay"></div>
    <div class="menu-panel" id="menuPanel">
        <div class="menu-content">
            <a href="https://blog.lonzov.top/posts/tool-about/" class="menu-item" target="_blank">
                <i class="fa-solid fa-circle-info"></i> 关于
            </a>
            <a href="https://afdian.com/a/lonzov" class="menu-item" target="_blank">
                <i class="fa-solid fa-hand-holding-heart"></i> 打赏
            </a>
            <a href="https://qm.qq.com/q/hjTqUyIKEo" class="menu-item" target="_blank">
                <i class="fa-brands fa-qq"></i> QQ群
            </a>
            <a href="https://blog.lonzov.top/" class="menu-item" target="_blank">
                <i class="fa-solid fa-blog"></i> 博客
            </a>
            <!--a href="https://f.kdocs.cn/g/JfmI2Ch8/" class="menu-item" target="_blank">
                <i class="fa-solid fa-clipboard-list"></i> 问卷
            </a-->
            <a href="javascript:void(0)" onclick="showSurveyModal()" class="menu-item">
                <i class="fa-solid fa-robot"></i> ai 助手
            </a>
            <a href="#" id="pwa-install-trigger" class="menu-item">
                <i class="fa-solid fa-download"></i> 安装
            </a>
        </div>
    </div>
    <main class="container">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-box" placeholder="搜索工具、资源...">
            <button id="clearSearch" class="clear-icon">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="category-container">
            <div class="category-scroll-fade category-scroll-fade-left"></div>
            <div class="category-scroll-fade category-scroll-fade-right"></div>
            <div class="category-filter" id="categoryFilter">
                <button class="filter-btn active" data-category="all">全部</button>
                <button class="filter-btn" data-category="command">在线工具</button>
                <button class="filter-btn" data-category="recom">延伸推荐</button>
                <button class="filter-btn" data-category="forum">社区论坛</button>
                <button class="filter-btn" data-category="creation">创作工具</button>
                <button class="filter-btn" data-category="other">百宝箱</button>
                <button class="filter-btn" data-category="resource">其他资源</button>
            </div>
        </div>
        <!-- 动态卡片容器 -->
        <div class="cards-container" id="cardsContainer">
        </div>

        <button id="backToTop" class="back-to-top" title="回到顶部">
            <i class="fas fa-arrow-up"></i>
        </button>
    </main>
    <footer class="container">
        <p>排序方式: 添加时间>主观使用频率</p>
        <p>© 2025 小舟工具箱 | <a href="https://icp.gov.moe/?keyword=20250698" target="_blank">萌ICP备20250698号</a></p>
        <p>本站已苟活 <span id="timer">--年--天--时--分</span></p>
        <script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/3Ltl0yXYWQcgbDgB/quote.js?theme=#1690FF,#333333,#777777,#777777,#FFFFFF,#1690FF,11&f=12&display=0,1,1,1,1,1,1,1"></script>
    </footer>
    <script src="./index.js"></script>
    <script>
        // Service Worker 注册并监听更新
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js', { scope: '/' })
                    .then(reg => {
                        console.log('SW registered:', reg.scope);
                        console.debug('SW registration:', reg);

                        // 监听安装中状态
                        reg.addEventListener('updatefound', () => {
                            const newSW = reg.installing;
                            if (!newSW) return;
                            newSW.addEventListener('statechange', () => {
                                if (newSW.state === 'installed' && navigator.serviceWorker.controller) {
                                    openSWUpdateDialog(reg);
                                }
                            });
                        });

                        // 如果已有 waiting worker，立即提示用户
                        if (reg.waiting && navigator.serviceWorker.controller) {
                            console.log('SW has waiting worker - showing update banner');
                            openSWUpdateDialog(reg);
                        }
                    })
                    .catch(err => console.warn('SW registration failed', err));
            });

            // 当新的 service worker 接管页面时刷新页面
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                console.log('navigator.serviceWorker controllerchange -> reloading');
                window.location.reload();
            });
        }

        (function () {
            'use strict';

            let deferredPrompt = null;

            // 检测是否已作为 PWA 安装运行
            function isPWAInstalled() {
                return (
                    window.matchMedia('(display-mode: standalone)').matches ||
                    window.navigator.standalone === true
                );
            }

            // 更新按钮为已安装状态
            function markAsInstalled() {
                const btn = document.getElementById('pwa-install-trigger');
                if (!btn) return;

                btn.innerHTML = '<i class="fa-solid fa-square-check"></i> 已安装';
                btn.style.opacity = '0.6';
                btn.style.pointerEvents = 'none';
                btn.style.cursor = 'default';
            }

            // 安装失败弹窗
            function showInstallFailedModal(reason = 'unknown') {
                let title = '安装失败';
                let content = '';
                let buttons = [];

                switch (reason) {
                    case 'user-dismissed':
                        content = '<p>您在安装弹窗中选择了"取消"。</p>' +
                            '<p>请再次点击按钮，并在弹出窗口中点击<strong>"确认安装"</strong>完成操作。</p>';
                        buttons = [{ text: '好的', style: "gray", action: 'close' }];
                        break;

                    case 'ios-manual':
                        content = '<p>iOS 系统需要手动添加到主屏幕：<br>· 点击 Safari 底部的 <i class="fa-solid fa-share-nodes"></i> 分享按钮<br>· 在菜单中找到并点击 <strong>"添加到主屏幕"</strong><br>· 点击右上角 <strong>"添加"</strong> 即可完成</p>' +
                            '<p>完成后，桌面上会出现本应用图标</p>';
                        buttons = [{ text: '好的', style: "gray", action: 'close' }];
                        break;

                    default:
                        content = '<p>当前设备或浏览器暂时无法自动安装。</p>' +
                                '<p>您可以尝试：<br>· 使用 <strong>Chrome、Edge </strong>或<strong>系统自带的浏览器</strong><br>· 刷新页面重试</p>' +
                                '<p>仍不成功？您可以尝试下方的"安卓下载"</p>';


                        buttons = [
                            { text: "安卓下载", style: "", action: "open_link", url: "https://o.o3o.ren/SknQMk" },
                            { text: '好的', style: "gray", action: 'close' }
                        ];
                        break;
                }

                showModal({
                    id: 'pwa_install_fail_v2',
                    version: '2.0',
                    title: title,
                    titleColor: 'default',
                    content: content,
                    buttons: buttons,
                    forceShow: true
                });
            }

            // 点击处理函数
            function onInstallClick(event) {
                event.preventDefault();

                if (isPWAInstalled()) return;
                // iOS 直接触发引导弹窗（不尝试 deferredPrompt）
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    showInstallFailedModal('ios-manual');
                    return;
                }

                // 非iOS：尝试触发安装
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choice) => {
                        deferredPrompt = null;
                        if (choice.outcome === 'accepted') {
                            markAsInstalled();
                        } else {
                            // 用户点击取消
                            showInstallFailedModal('user-dismissed');
                        }
                    }).catch(() => {
                        // 极端情况：prompt 调用失败（如无 secure context）
                        showInstallFailedModal('browser-no-support');
                    });
                } else {
                    // deferredPrompt 未捕获 → 条件不满足（无 SW / manifest / 未交互等）
                    showInstallFailedModal();
                }
            }

            // 初始化
            function initPWAInstallButton() {
                const btn = document.getElementById('pwa-install-trigger');
                if (!btn) return;

                btn.addEventListener('click', onInstallClick);

                if (isPWAInstalled()) {
                    markAsInstalled();
                }
            }

            // 等待 DOM 加载
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initPWAInstallButton);
            } else {
                initPWAInstallButton();
            }

            // 监听 beforeinstallprompt（用于非 iOS）
            window.addEventListener('beforeinstallprompt', (e) => {
                if (!/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    e.preventDefault();
                    deferredPrompt = e;
                }
            });

        })();

        // 保存当前Service Worker版本到localStorage
        function saveCurrentSWVersion() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                const messageChannel = new MessageChannel();
                messageChannel.port1.onmessage = function(event) {
                    const swVersion = event.data.version;
                    localStorage.setItem('current_sw_version', swVersion);
                };
                navigator.serviceWorker.controller.postMessage({type: 'GET_VERSION'}, [messageChannel.port2]);
            }
        }

        // 页面加载完成后获取并保存当前SW版本
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // 等待Service Worker控制器可用后保存版本
                if (navigator.serviceWorker.controller) {
                    // 如果已经有控制器，直接获取并保存版本
                    saveCurrentSWVersion();
                } else {
                    // 如果没有控制器，等待控制器变更事件
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        saveCurrentSWVersion();
                    });
                }
            });
        }

        // Service Worker 更新通知
        (function () {
            function showSWUpdateModal(reg) {
                // 获取当前活动的SW版本
                let currentSWVersion = '未知';
                if (navigator.serviceWorker && navigator.serviceWorker.controller) {
                    currentSWVersion = localStorage.getItem('current_sw_version') || '未知';
                }

                // 获取等待安装的SW版本
                const messageChannel = new MessageChannel();
                messageChannel.port1.onmessage = function(event) {
                    const newSWVersion = event.data.version;
                    showUpdateDialog(currentSWVersion, newSWVersion, reg);
                };
                reg.waiting.postMessage({type: 'GET_VERSION'}, [messageChannel.port2]);
            }

            // 显示更新对话框
            function showUpdateDialog(currentVersion, newVersion, reg) {
                const updateModal = {
                    title: "发现新版本",
                    id: "sw_update_notification",
                    version: newVersion,
                    forceShow: true,
                    content: `
                        <p>[+] AI助手beta版已发布(入口在顶部三横菜单中)<br>[+] 现在可以把网站安装到桌面啦~(顶部三横菜单中)</p>
                        <p><strong>·</strong> 新卡片：无</p>
                        <p><strong>·</strong> 建议/反馈请加Q群: <a href="https://qm.qq.com/q/dgYFOtx4Qg" target="_blank" style="color:var(--text-color);">587984701</a></p>
                        <p style="font-size:14px;color:#666;margin-top:10px;">当前版本: ${currentVersion} → 最新版本: ${newVersion}</p>
                    `,
                    buttons: [
                        { text: "了解更多", style: "gray", action: "open_link", url: " https://blog.lonzov.top/posts/tool-update/ " },
                        {
                            text: "立即更新",
                            style: "blue",
                            action: "custom",
                            customAction: {
                                type: "update_sw",
                                registration: reg
                            }
                        },
                        { text: "暂不更新", style: "red", action: "close" },
                    ]
                };

                showModal(updateModal);
            }

            // 监听 Service Worker 更新
            function openSWUpdateDialog(reg) {
                console.log('Service Worker 更新可用:', reg);
                showSWUpdateModal(reg);
            }

            // 挂载到全局
            window.openSWUpdateDialog = openSWUpdateDialog;

            // 监听自定义事件，处理模态框中的更新操作
            window.addEventListener('sw_modal_action', function(e) {
                if (e.detail && e.detail.type === 'update_sw') {
                    const reg = e.detail.registration;

                    // 创建一个临时的更新状态提示
                    const updateStatusModal = {
                        title: "正在更新...",
                        id: "sw_update_progress",
                        version: Date.now().toString(),
                        forceShow: true,
                        content: `<p>正在下载最新版本，请稍候...</p><div class="loading-indicator"><div class="spinner"></div></div>`,
                        buttons: []
                    };

                    // 临时显示进度
                    showModal(updateStatusModal);

                    // 发送 SKIP_WAITING 消息给 Service Worker
                    if (reg && reg.waiting) {
                        reg.waiting.postMessage('SKIP_WAITING');

                        // 监听控制器变化以刷新页面
                        let controllerChangeListener = function() {
                            console.log('Service Worker 控制器已变更，刷新页面...');
                            window.location.reload();
                        };

                        navigator.serviceWorker.addEventListener('controllerchange', controllerChangeListener);

                        // 设置超时处理
                        setTimeout(() => {
                            navigator.serviceWorker.removeEventListener('controllerchange', controllerChangeListener);
                            closeModalById("sw_update_progress");

                            // 如果还没刷新，直接刷新页面
                            window.location.reload();
                        }, 10000); // 10秒超时
                    }
                }
            });

            // 添加更新检查功能
            window.checkForUpdates = function() {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(function(registrations) {
                        for(let registration of registrations) {
                            registration.update();
                        }
                    });
                }
            };
        })();
    </script>
</body>
</html>